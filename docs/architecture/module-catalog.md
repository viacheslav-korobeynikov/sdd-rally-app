# Каталог модулей системы

**Статус**: Черновик  
**Версия**: 0.1.0  
**Последнее обновление**: 2025-12-17

## Обзор

Этот документ описывает доменные модули приложения SDD Rally App, их ответственность, открытые интерфейсы и зависимости.

## Доменные модули

### 1. Competitions (Соревнования)

**Ответственность**:
- Управление метаданными соревнований (название, дата, место проведения, регламент)
- Статусы соревнований (планируется, регистрация открыта, проводится, завершено)
- Управление организаторами и их ролями в конкретном соревновании

**Открытые интерфейсы**:
- `CreateCompetition(ctx, data) -> Competition`
- `GetCompetition(ctx, id) -> Competition`
- `ListCompetitions(ctx, filters) -> []Competition`
- `UpdateCompetitionStatus(ctx, id, status) -> error`

**Зависимости**:
- Нет прямых зависимостей от других доменных модулей

---

### 2. Stages (Спецучастки)

**Ответственность**:
- Управление спецучастками соревнования (название, длина, характеристики)
- Порядок прохождения спецучастков
- Временные окна для старта на СУ

**Открытые интерфейсы**:
- `CreateStage(ctx, competitionID, data) -> Stage`
- `GetStage(ctx, id) -> Stage`
- `ListStagesByCompetition(ctx, competitionID) -> []Stage`
- `UpdateStageOrder(ctx, competitionID, stageIDs) -> error`

**Зависимости**:
- `Competitions`: Каждый СУ принадлежит соревнованию

---

### 3. Crews (Экипажи и участники)

**Ответственность**:
- Регистрация и управление экипажами (пилот + штурман)
- Данные участников (ФИО, лицензии, контакты)
- Информация об автомобилях (марка, модель, класс, группа)
- Стартовые номера

**Открытые интерфейсы**:
- `RegisterCrew(ctx, competitionID, data) -> Crew`
- `GetCrew(ctx, id) -> Crew`
- `ListCrews(ctx, competitionID, filters) -> []Crew`
- `UpdateCrewStatus(ctx, id, status) -> error`
- `AssignStartNumber(ctx, crewID, number) -> error`

**Зависимости**:
- `Competitions`: Экипажи регистрируются на конкретное соревнование

---

### 4. Timing (Хронометраж)

**Ответственность**:
- Фиксация времени старта и финиша на СУ
- Расчёт результатов прохождения СУ
- Валидация временных данных

**Открытые интерфейсы**:
- `RecordStartTime(ctx, crewID, stageID, time) -> error`
- `RecordFinishTime(ctx, crewID, stageID, time) -> error`
- `GetStageResult(ctx, crewID, stageID) -> StageResult`
- `ListStageResults(ctx, stageID) -> []StageResult`

**Зависимости**:
- `Crews`: Время фиксируется для конкретного экипажа
- `Stages`: Время фиксируется на конкретном СУ

---

### 5. Results (Результаты и классификация)

**Ответственность**:
- Расчёт общих результатов соревнования
- Применение штрафов (опоздание, опережение, технические нарушения)
- Классификация по классам и группам
- Определение победителей в различных зачётах

**Открытые интерфейсы**:
- `CalculateOverallResults(ctx, competitionID) -> []OverallResult`
- `ApplyPenalty(ctx, crewID, stageID, penalty) -> error`
- `GetClassification(ctx, competitionID, classType) -> []ClassificationEntry`
- `GetCrewFinalResult(ctx, crewID) -> FinalResult`

**Зависимости**:
- `Competitions`: Результаты рассчитываются для соревнования
- `Crews`: Результаты связаны с экипажами
- `Timing`: Использует данные хронометража
- `Stages`: Учитывает результаты по всем СУ

---

### 6. Documents (Документы и протоколы)

**Ответственность**:
- Генерация официальных документов (стартовые ведомости, протоколы результатов)
- Шаблоны документов
- Экспорт в различные форматы (PDF, Excel)

**Открытые интерфейсы**:
- `GenerateStartList(ctx, competitionID) -> Document`
- `GenerateResultProtocol(ctx, competitionID, stageID) -> Document`
- `GenerateFinalProtocol(ctx, competitionID) -> Document`
- `ExportDocument(ctx, documentID, format) -> File`

**Зависимости**:
- `Competitions`: Документы генерируются для соревнования
- `Crews`: Стартовые ведомости содержат данные экипажей
- `Results`: Протоколы содержат результаты

---

## Граф зависимостей

```
┌─────────────────┐
│  Competitions   │ (Корневой модуль)
└────────┬────────┘
         │
    ┌────┴─────┬────────────┬────────────┐
    │          │            │            │
┌───▼────┐ ┌──▼────┐   ┌───▼────┐       │
│ Stages │ │ Crews │   │Documents│       │
└───┬────┘ └───┬───┘   └───┬────┘       │
    │          │            │            │
    └────┬─────┴────┐       │            │
         │          │       │            │
      ┌──▼──────┐   │       │            │
      │ Timing  │   │       │            │
      └──┬──────┘   │       │            │
         │          │       │            │
         └────┬─────┴───────┴────────────┘
              │
         ┌────▼────┐
         │ Results │ (Агрегирующий модуль)
         └─────────┘
```

## Принципы взаимодействия модулей

1. **Однонаправленные зависимости**: Модули зависят только от модулей ниже по иерархии
2. **Интерфейсы как контракты**: Взаимодействие только через определённые интерфейсы
3. **Отсутствие циклических зависимостей**: Граф зависимостей должен быть ациклическим
4. **Shared Kernel**: Общие типы (ID, временные метки, перечисления) выделены в отдельный пакет

## Следующие шаги

- [ ] Детализировать структуры данных для каждого модуля
- [ ] Определить события (domain events) для межмодульной коммуникации
- [ ] Создать диаграммы последовательностей для ключевых сценариев
- [ ] Документировать бизнес-правила для каждого модуля

