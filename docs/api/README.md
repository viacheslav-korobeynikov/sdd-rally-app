# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

SDD Rally App –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º–∏, —ç–∫–∏–ø–∞–∂–∞–º–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**Base URL**: `http://localhost:3000/api/v1` (development)

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: JSON

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: Session-based (cookies)

## –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### HTTP Methods

| –ú–µ—Ç–æ–¥ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-------|--------------|
| GET | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Å–ø–∏—Å–∫–∏, –¥–µ—Ç–∞–ª–∏) |
| POST | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ |
| PUT | –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ |
| PATCH | –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ |
| DELETE | –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ |

### HTTP Status Codes

| –ö–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----|----------|
| 200 | OK - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| 201 | Created - –†–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω |
| 204 | No Content - –£—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ |
| 400 | Bad Request - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| 401 | Unauthorized - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| 403 | Forbidden - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
| 404 | Not Found - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| 409 | Conflict - –ö–æ–Ω—Ñ–ª–∏–∫—Ç –¥–∞–Ω–Ω—ã—Ö |
| 500 | Internal Server Error - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç**:
```json
{
  "data": { ... },
  "meta": {
    "timestamp": "2025-12-17T10:30:00Z"
  }
}
```

**–û—Ç–≤–µ—Ç —Å–æ —Å–ø–∏—Å–∫–æ–º**:
```json
{
  "data": [ ... ],
  "meta": {
    "total": 42,
    "page": 1,
    "per_page": 20,
    "timestamp": "2025-12-17T10:30:00Z"
  }
}
```

**–û—à–∏–±–∫–∞**:
```json
{
  "error": {
    "code": "INVALID_INPUT",
    "message": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ",
    "details": {
      "field": "name",
      "constraint": "required"
    }
  },
  "meta": {
    "timestamp": "2025-12-17T10:30:00Z",
    "request_id": "abc-123-def"
  }
}
```

## –ú–æ–¥—É–ª–∏ API

### 1. Authentication
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/auth/login` - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `POST /api/v1/auth/logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `GET /api/v1/auth/me` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./auth.md)

---

### 2. Competitions
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º–∏.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /api/v1/competitions` - –°–ø–∏—Å–æ–∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π
- `POST /api/v1/competitions` - –°–æ–∑–¥–∞—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ
- `GET /api/v1/competitions/:id` - –î–µ—Ç–∞–ª–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è
- `PUT /api/v1/competitions/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ
- `DELETE /api/v1/competitions/:id` - –£–¥–∞–ª–∏—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ
- `PATCH /api/v1/competitions/:id/status` - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./competitions.md) *(–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)*

---

### 3. Stages
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—É—á–∞—Å—Ç–∫–∞–º–∏.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /api/v1/competitions/:competitionId/stages` - –°–ø–∏—Å–æ–∫ –°–£
- `POST /api/v1/competitions/:competitionId/stages` - –°–æ–∑–¥–∞—Ç—å –°–£
- `GET /api/v1/stages/:id` - –î–µ—Ç–∞–ª–∏ –°–£
- `PUT /api/v1/stages/:id` - –û–±–Ω–æ–≤–∏—Ç—å –°–£
- `DELETE /api/v1/stages/:id` - –£–¥–∞–ª–∏—Ç—å –°–£
- `POST /api/v1/competitions/:competitionId/stages/reorder` - –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./stages.md) *(–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)*

---

### 4. Crews
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫–∏–ø–∞–∂–∞–º–∏ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `GET /api/v1/competitions/:competitionId/crews` - –°–ø–∏—Å–æ–∫ —ç–∫–∏–ø–∞–∂–µ–π
- `POST /api/v1/competitions/:competitionId/crews` - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–∫–∏–ø–∞–∂
- `GET /api/v1/crews/:id` - –î–µ—Ç–∞–ª–∏ —ç–∫–∏–ø–∞–∂–∞
- `PUT /api/v1/crews/:id` - –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —ç–∫–∏–ø–∞–∂–∞
- `DELETE /api/v1/crews/:id` - –£–¥–∞–ª–∏—Ç—å —ç–∫–∏–ø–∞–∂
- `PATCH /api/v1/crews/:id/status` - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏
- `POST /api/v1/crews/:id/start-number` - –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./crews.md) *(–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)*

---

### 5. Timing
–•—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –°–£.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/timing/start` - –§–∏–∫—Å–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–∞
- `POST /api/v1/timing/finish` - –§–∏–∫—Å–∞—Ü–∏—è —Ñ–∏–Ω–∏—à–∞
- `GET /api/v1/timing/stage/:stageId/results` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –°–£
- `GET /api/v1/timing/crew/:crewId/results` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫–∏–ø–∞–∂–∞

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./timing.md) *(–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)*

---

### 6. Results
–†–∞—Å—á—ë—Ç –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/competitions/:competitionId/results/calculate` - –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- `GET /api/v1/competitions/:competitionId/results/overall` - –û–±—â–∏–π –∑–∞—á—ë—Ç
- `GET /api/v1/competitions/:competitionId/results/by-class/:class` - –ó–∞—á—ë—Ç –ø–æ –∫–ª–∞—Å—Å—É
- `POST /api/v1/results/:crewId/penalties` - –ü—Ä–∏–º–µ–Ω–∏—Ç—å —à—Ç—Ä–∞—Ñ
- `GET /api/v1/crews/:crewId/final-result` - –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ç–∫–∏–ø–∞–∂–∞

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./results.md) *(–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)*

---

### 7. Documents
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
- `POST /api/v1/competitions/:competitionId/documents/start-list` - –°—Ç–∞—Ä—Ç–æ–≤–∞—è –≤–µ–¥–æ–º–æ—Å—Ç—å
- `POST /api/v1/competitions/:competitionId/documents/stage-protocol/:stageId` - –ü—Ä–æ—Ç–æ–∫–æ–ª –°–£
- `POST /api/v1/competitions/:competitionId/documents/final-protocol` - –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª
- `GET /api/v1/documents/:id/download` - –°–∫–∞—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](./documents.md) *(–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)*

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–∫—Ä–æ–º–µ `/auth/login`) —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**Session Cookie**: `session_id` (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π**:
```bash
curl -X GET \
  http://localhost:3000/api/v1/competitions \
  -H "Cookie: session_id=<–≤–∞—à-session-id>" \
  -H "Content-Type: application/json"
```

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–î–æ—Å—Ç—É–ø –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —Ä–æ–ª—è–º–∏:

| –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **chief_organizer** | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| **secretary** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫–∏–ø–∞–∂–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| **timing** | –í–≤–æ–¥ —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂–∞, –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| **observer** | –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ |

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](../security/standards.md#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-rbac).

## Rate Limiting

API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:

- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç
- **–û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / –º–∏–Ω—É—Ç—É

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞: `HTTP 429 Too Many Requests`

## CORS

CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –¥–æ–º–µ–Ω–æ–≤:
- `http://localhost:3000` (development)
- `https://staging.rally-app.example.com` (staging)
- `https://rally-app.example.com` (production)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### cURL

```bash
# –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "organizer", "password": "secure_pass"}' \
  -c cookies.txt

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è
curl -X POST http://localhost:3000/api/v1/competitions \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "name": "–ó–∏–º–Ω–∏–π –∫—É–±–æ–∫ 2025",
    "date": "2025-02-15",
    "location": "–ú–æ—Å–∫–≤–∞"
  }'
```

### JavaScript (fetch)

```javascript
// –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
const login = await fetch('/api/v1/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  credentials: 'include',
  body: JSON.stringify({
    username: 'organizer',
    password: 'secure_pass'
  })
});

// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π
const competitions = await fetch('/api/v1/competitions', {
  credentials: 'include'
}).then(r => r.json());
```

## –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API

API –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ URL: `/api/v1/`, `/api/v2/` –∏ —Ç.–¥.

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è**: v1

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–π**: –ü—Ä–µ–¥—ã–¥—É—â–∞—è –º–∞–∂–æ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è 6 –º–µ—Å—è—Ü–µ–≤ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –Ω–æ–≤–æ–π.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π:
1. –°–æ–∑–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
2. –î–æ–±–∞–≤–∏—Ç—å OpenAPI/Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Swagger UI –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

---

**–°—Ç–∞—Ç—É—Å**: üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-17

